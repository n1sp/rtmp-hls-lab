version: '3.8'

services:
  nginx:
    # ./nginx-rtmp フォルダ内の Dockerfileを使用
    build:
      context: ./nginx-rtmp
      dockerfile: Dockerfile
    # RTMPとHTTPのポートをホストに公開
    ports:
      - "1935:1935" # RTMP
      - "8080:8080" # HTTP/HLS
    # Goバックエンドが起動してから起動
    depends_on:
      - go-backend
    # サービス間の通信用ネットワーク
    networks:
      - streaming_net
  
  # --- Go Backend Service ---
  go-backend:
    build:
      context: ./go-backend
      dockerfile: Dockerfile
    # 内部通信用ポート8081
    expose:
      - "8081"
    # サービス間のネットワーク
    networks:
      - streaming_net

networks:
  streaming_net:
    driver: bridge
